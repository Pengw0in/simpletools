<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/public/logo.ico">
    <title>Regex Tester</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <style>
        /* Global Reset and Retro Font */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Press Start 2P', cursive;
        }

        /* Basic Retro Color Palette */
        :root {
            --window-bg: #c0c0c0; 
            --border-dark: #808080;
            --border-light: #ffffff;
            --text-color: #000000;
            --button-face: #c0c0c0;
            --button-pressed: #dfdfdf;
            --input-bg: #ffffff;
            --header-title: #000080;
            --error-color: #ffcccc;
            --success-color: #008000;
            --highlight-match: #ffff00;
        }

        body {
            background: #008080;
            color: var(--text-color);
            line-height: 1.6;
            padding: 30px;
        }

        /* --- Classic Windows Border Mixin --- */
        .window-frame {
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
            background: var(--window-bg);
            padding: 3px; 
            box-shadow: none;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0; 
        }

        /* --- Title Bar/Header --- */
        .title-bar {
            background: var(--header-title);
            color: var(--border-light);
            padding: 5px 8px;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-dark);
        }

        .title-bar-text {
            white-space: nowrap;
        }

        /* The main window body */
        .app-body {
            padding: 15px;
        }

        /* --- Section Styling (Sunken Panel) --- */
        .section {
            margin-bottom: 15px;
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            background: var(--button-pressed);
            padding: 1px;
        }

        .section-header {
            padding: 6px 8px;
            font-size: 11px;
            font-weight: normal;
            border-top: 1px solid var(--border-dark);
            border-left: 1px solid var(--border-dark);
            border-right: 1px solid var(--border-light);
            border-bottom: 1px solid var(--border-light);
            background: #ffffff; 
            display: inline-block;
            margin-bottom: -1px;
            position: relative;
            z-index: 10;
        }

        .section-content {
            padding: 15px;
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            background: var(--window-bg);
            margin-top: -1px;
        }

        /* --- Input Styling --- */
        .input-group {
            margin-bottom: 15px;
        }

        .input-label {
            display: block;
            margin-bottom: 6px;
            font-size: 10px;
            font-weight: normal;
            color: var(--text-color);
        }

        .regex-input-wrapper {
            display: flex;
            align-items: center;
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            background: var(--input-bg);
        }

        .regex-prefix {
            padding: 6px 8px;
            background: var(--button-pressed);
            border-right: 1px solid var(--border-dark);
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            color: var(--text-color);
        }

        .regex-input {
            flex: 1;
            padding: 6px 8px;
            border: none;
            outline: none;
            font-family: 'Press Start 2P', monospace;
            font-size: 9px;
            background: var(--input-bg);
            color: var(--text-color);
        }

        .flags-container {
            display: flex;
            gap: 8px;
            padding: 6px 8px;
            border-left: 1px solid var(--border-dark);
            background: var(--button-pressed);
        }

        .flag-checkbox {
            display: flex;
            align-items: center;
            gap: 3px;
            font-size: 9px;
            color: var(--text-color);
        }

        .flag-checkbox input {
            margin: 0;
            transform: scale(0.8);
        }

        .test-input {
            width: 100%;
            min-height: 120px;
            padding: 8px;
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            font-family: 'Press Start 2P', monospace;
            font-size: 8px;
            resize: vertical;
            outline: none;
            background: var(--input-bg);
            color: var(--text-color);
            line-height: 1.4;
        }

        .test-input:focus {
            box-shadow: 0 0 0 1px var(--text-color) inset;
        }

        .test-input::placeholder {
            color: var(--border-dark);
        }

        /* --- Controls --- */
        .controls {
            margin-bottom: 15px;
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
            background: var(--button-face);
            color: var(--text-color);
            padding: 6px 12px;
            font-size: 10px;
            text-align: center;
            cursor: pointer;
            transition: none;
            box-shadow: none;
            line-height: 1;
            font-family: 'Press Start 2P', cursive;
        }

        .btn:active {
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            padding: 7px 11px 5px 13px;
        }

        .btn-primary {
            background: var(--header-title);
            color: var(--border-light);
        }

        /* --- Stats Section --- */
        .stats {
            background: var(--input-bg);
            padding: 12px;
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            margin-bottom: 15px;
            display: flex;
            gap: 20px;
            font-size: 10px;
            flex-wrap: wrap;
        }

        .stat-item {
            color: var(--text-color);
        }

        .stat-value {
            font-weight: normal;
            color: var(--header-title);
        }

        .stat-value.success {
            color: var(--success-color);
        }

        .stat-value.error {
            color: #cc0000;
        }

        /* --- Results Container --- */
        .results-container {
            background: var(--input-bg);
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            padding: 15px;
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 11px;
            font-weight: normal;
            margin-bottom: 10px;
            color: var(--text-color);
            padding: 4px;
            background: var(--button-pressed);
            border-style: solid;
            border-width: 1px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            display: inline-block;
        }

        .highlighted-text {
            font-family: 'Press Start 2P', monospace;
            font-size: 8px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            padding: 8px;
            background: var(--input-bg);
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            margin-bottom: 15px;
        }

        .match-highlight {
            background: var(--highlight-match);
            color: var(--text-color);
            padding: 1px 2px;
        }

        /* --- Matches Section --- */
        .matches-section {
            margin-bottom: 15px;
        }

        .match-item {
            background: var(--button-pressed);
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            padding: 8px;
            margin-bottom: 8px;
            font-family: 'Press Start 2P', monospace;
            font-size: 8px;
        }

        .match-text {
            color: var(--success-color);
            font-weight: normal;
            margin-bottom: 3px;
        }

        .match-details {
            color: var(--border-dark);
            font-size: 7px;
        }

        /* --- Groups Section --- */
        .groups-section {
            margin-bottom: 15px;
        }

        .group-item {
            background: #e6f3ff;
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            padding: 6px 8px;
            margin-bottom: 6px;
            font-family: 'Press Start 2P', monospace;
            font-size: 8px;
        }

        .group-index {
            color: var(--header-title);
            font-weight: normal;
        }

        /* --- Examples Section --- */
        .examples {
            background: var(--input-bg);
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            padding: 15px;
        }

        .example-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            border-bottom: 1px solid var(--border-dark);
            cursor: pointer;
            transition: none;
        }

        .example-item:hover {
            background: var(--button-pressed);
            margin: 0 -8px;
            padding: 6px 8px;
        }

        .example-item:last-child {
            border-bottom: none;
        }

        .example-regex {
            font-family: 'Press Start 2P', monospace;
            background: var(--button-pressed);
            padding: 3px 6px;
            border-style: solid;
            border-width: 1px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            font-size: 8px;
            min-width: 100px;
        }

        .example-description {
            color: var(--text-color);
            font-size: 9px;
        }

        /* --- Error Display --- */
        .error {
            background: var(--error-color);
            color: var(--text-color);
            padding: 12px;
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            font-size: 10px;
            margin: 15px 0;
        }

        /* --- Hidden Elements --- */
        .hidden {
            display: none;
        }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                max-width: 100%;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 200px;
            }
            
            .stats {
                flex-direction: column;
                gap: 8px;
            }

            .flags-container {
                flex-direction: column;
                gap: 6px;
            }

            .example-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .test-input {
                min-height: 100px;
                font-size: 7px;
            }

            .highlighted-text {
                font-size: 7px;
            }
        }

        @media (max-width: 480px) {
            .test-input {
                font-size: 6px;
            }

            .highlighted-text {
                font-size: 6px;
            }

            .match-item {
                font-size: 7px;
            }
        }
    </style>
</head>
<body>
    <div class="container window-frame">
        <div class="title-bar">
            <div class="title-bar-text">Regex Tester</div>
        </div>
        
        <div class="app-body">
            <div class="section">
                <div class="section-header">Regular Expression Input</div>
                <div class="section-content">
                    <div class="input-group">
                        <label class="input-label">Regular Expression</label>
                        <div class="regex-input-wrapper">
                            <span class="regex-prefix">/</span>
                            <input type="text" class="regex-input" id="regexInput" placeholder="Enter your regex pattern..." oninput="testRegex()">
                            <div class="flags-container">
                                <label class="flag-checkbox">
                                    <input type="checkbox" id="flagGlobal" onchange="testRegex()">
                                    <span>g</span>
                                </label>
                                <label class="flag-checkbox">
                                    <input type="checkbox" id="flagIgnoreCase" onchange="testRegex()">
                                    <span>i</span>
                                </label>
                                <label class="flag-checkbox">
                                    <input type="checkbox" id="flagMultiline" onchange="testRegex()">
                                    <span>m</span>
                                </label>
                            </div>
                            <span class="regex-prefix">/</span>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Test String</label>
                        <textarea class="test-input" id="testInput" placeholder="Enter text to test against your regex..." oninput="testRegex()"></textarea>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="clearInputs()">Clear All</button>
                <button class="btn" onclick="copyRegex(this)">Copy Regex</button>
            </div>

            <div class="stats" id="stats">
                <div class="stat-item">Status: <span class="stat-value" id="statusValue">Ready</span></div>
                <div class="stat-item">Matches: <span class="stat-value" id="matchCount">0</span></div>
                <div class="stat-item">Groups: <span class="stat-value" id="groupCount">0</span></div>
            </div>

            <div class="section">
                <div class="section-header">Results</div>
                <div class="section-content" style="padding: 0;">
                    <div class="results-container">
                        <div class="section-title">Highlighted Text</div>
                        <div class="highlighted-text" id="highlightedText">Enter a regex pattern and test string to see matches highlighted here.</div>
                        
                        <div class="matches-section" id="matchesSection" style="display: none;">
                            <div class="section-title">Matches</div>
                            <div id="matchesList"></div>
                        </div>

                        <div class="groups-section" id="groupsSection" style="display: none;">
                            <div class="section-title">Capture Groups</div>
                            <div id="groupsList"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">Common Patterns</div>
                <div class="section-content">
                    <div class="examples">
                        <div class="example-item" onclick="loadExample('^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$', 'Email validation')">
                            <code class="example-regex">^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$</code>
                            <span class="example-description">Email validation</span>
                        </div>
                        <div class="example-item" onclick="loadExample('\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\b', 'IP address matching')">
                            <code class="example-regex">\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b</code>
                            <span class="example-description">IP address matching</span>
                        </div>
                        <div class="example-item" onclick="loadExample('https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&//=]*)', 'URL matching')">
                            <code class="example-regex">https?://...</code>
                            <span class="example-description">URL matching</span>
                        </div>
                        <div class="example-item" onclick="loadExample('\\b\\w+\\b', 'Word boundaries')">
                            <code class="example-regex">\b\w+\b</code>
                            <span class="example-description">Word boundaries</span>
                        </div>
                        <div class="example-item" onclick="loadExample('(\\d{4})-(\\d{2})-(\\d{2})', 'Date with groups (YYYY-MM-DD)')">
                            <code class="example-regex">(\d{4})-(\d{2})-(\d{2})</code>
                            <span class="example-description">Date with groups (YYYY-MM-DD)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentRegex = null;
        let testString = '';

        function testRegex() {
            const regexPattern = document.getElementById('regexInput').value;
            testString = document.getElementById('testInput').value;
            
            if (!regexPattern) {
                resetResults();
                return;
            }

            try {
                const flags = getFlags();
                currentRegex = new RegExp(regexPattern, flags);
                
                updateStats('success');
                highlightMatches();
                showMatches();
                showGroups();
                
            } catch (error) {
                displayError(error.message);
                updateStats('error');
            }
        }

        function getFlags() {
            let flags = '';
            if (document.getElementById('flagGlobal').checked) flags += 'g';
            if (document.getElementById('flagIgnoreCase').checked) flags += 'i';
            if (document.getElementById('flagMultiline').checked) flags += 'm';
            return flags;
        }

        function updateStats(status) {
            const statusElement = document.getElementById('statusValue');
            const matchCountElement = document.getElementById('matchCount');
            const groupCountElement = document.getElementById('groupCount');

            if (status === 'error') {
                statusElement.textContent = 'Error';
                statusElement.className = 'stat-value error';
                matchCountElement.textContent = '0';
                groupCountElement.textContent = '0';
                return;
            }

            statusElement.textContent = 'Valid';
            statusElement.className = 'stat-value success';

            if (currentRegex && testString) {
                const matches = [...testString.matchAll(currentRegex)];
                matchCountElement.textContent = matches.length;
                
                const groupsCount = matches.length > 0 ? Math.max(0, matches[0].length - 1) : 0;
                groupCountElement.textContent = groupsCount;
            } else {
                matchCountElement.textContent = '0';
                groupCountElement.textContent = '0';
            }
        }

        function highlightMatches() {
            const highlightedElement = document.getElementById('highlightedText');
            
            if (!currentRegex || !testString) {
                highlightedElement.textContent = 'Enter a regex pattern and test string to see matches highlighted here.';
                return;
            }

            const matches = [...testString.matchAll(currentRegex)];
            
            if (matches.length === 0) {
                highlightedElement.innerHTML = escapeHtml(testString);
                return;
            }

            let highlightedText = '';
            let lastIndex = 0;

            matches.forEach(match => {
                // Add text before match
                highlightedText += escapeHtml(testString.slice(lastIndex, match.index));
                
                // Add highlighted match
                highlightedText += `<span class="match-highlight">${escapeHtml(match[0])}</span>`;
                
                lastIndex = match.index + match[0].length;
            });

            // Add remaining text
            highlightedText += escapeHtml(testString.slice(lastIndex));

            highlightedElement.innerHTML = highlightedText;
        }

        function showMatches() {
            const matchesSection = document.getElementById('matchesSection');
            const matchesList = document.getElementById('matchesList');

            if (!currentRegex || !testString) {
                matchesSection.style.display = 'none';
                return;
            }

            const matches = [...testString.matchAll(currentRegex)];
            
            if (matches.length === 0) {
                matchesSection.style.display = 'none';
                return;
            }

            matchesSection.style.display = 'block';
            matchesList.innerHTML = '';

            matches.forEach((match, index) => {
                const matchItem = document.createElement('div');
                matchItem.className = 'match-item';
                
                matchItem.innerHTML = `
                    <div class="match-text">${escapeHtml(match[0])}</div>
                    <div class="match-details">Match ${index + 1} at position ${match.index}-${match.index + match[0].length - 1}</div>
                `;
                
                matchesList.appendChild(matchItem);
            });
        }

        function showGroups() {
            const groupsSection = document.getElementById('groupsSection');
            const groupsList = document.getElementById('groupsList');

            if (!currentRegex || !testString) {
                groupsSection.style.display = 'none';
                return;
            }

            const matches = [...testString.matchAll(currentRegex)];
            
            if (matches.length === 0 || (matches[0] && matches[0].length <= 1)) {
                groupsSection.style.display = 'none';
                return;
            }

            groupsSection.style.display = 'block';
            groupsList.innerHTML = '';

            matches.forEach((match, matchIndex) => {
                if (match.length > 1) {
                    for (let i = 1; i < match.length; i++) {
                        const groupItem = document.createElement('div');
                        groupItem.className = 'group-item';
                        
                        const groupValue = match[i] !== undefined ? match[i] : '';
                        
                        groupItem.innerHTML = `
                            <span class="group-index">Group ${i}:</span> ${escapeHtml(groupValue)}
                        `;
                        
                        groupsList.appendChild(groupItem);
                    }
                }
            });
        }

        function displayError(message) {
            // Reset the highlighted text to show error
            const highlightedElement = document.getElementById('highlightedText');
            highlightedElement.innerHTML = `<div class="error">Regex Error: ${message}</div>`;
            
            document.getElementById('matchesSection').style.display = 'none';
            document.getElementById('groupsSection').style.display = 'none';
        }

        function resetResults() {
            document.getElementById('highlightedText').textContent = 'Enter a regex pattern and test string to see matches highlighted here.';
            document.getElementById('matchesSection').style.display = 'none';
            document.getElementById('groupsSection').style.display = 'none';
            updateStats('ready');
            
            document.getElementById('statusValue').textContent = 'Ready';
            document.getElementById('statusValue').className = 'stat-value';
        }

        function clearInputs() {
            document.getElementById('regexInput').value = '';
            document.getElementById('testInput').value = '';
            document.getElementById('flagGlobal').checked = false;
            document.getElementById('flagIgnoreCase').checked = false;
            document.getElementById('flagMultiline').checked = false;
            
            currentRegex = null;
            testString = '';
            resetResults();
        }

        function copyRegex(btn) {
            const regexPattern = document.getElementById('regexInput').value;
            const flags = getFlags();
            
            if (!regexPattern) {
                return;
            }

            const regexString = `/${regexPattern}/${flags}`;
            
            // Use fallback copy method
            const tempInput = document.createElement('textarea');
            tempInput.value = regexString;
            document.body.appendChild(tempInput);
            tempInput.select();
            
            try {
                document.execCommand('copy');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 1500);
            } catch (err) {
                console.error('Failed to copy text:', err);
            }
            
            document.body.removeChild(tempInput);
        }

        function loadExample(pattern, description) {
            document.getElementById('regexInput').value = pattern;
            document.getElementById('flagGlobal').checked = true;
            
            // Set appropriate test strings based on pattern
            let testText = '';
            if (description.includes('Email')) {
                testText = 'Contact us at john@example.com or support@company.org for help.';
            } else if (description.includes('IP')) {
                testText = 'Server IPs: 192.168.1.1, 10.0.0.1, and 255.255.255.0';
            } else if (description.includes('URL')) {
                testText = 'Visit https://www.example.com or http://test.org for more info.';
            } else if (description.includes('Word')) {
                testText = 'The quick brown fox jumps over the lazy dog.';
            } else if (description.includes('Date')) {
                testText = 'Important dates: 2023-12-25, 2024-01-01, and 2024-07-04';
            }
            
            document.getElementById('testInput').value = testText;
            testRegex();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Load regex from URL parameters on page load
        window.addEventListener('load', () => {
            const params = new URLSearchParams(window.location.search);
            const regex = params.get('regex');
            const flags = params.get('flags') || '';
            const test = params.get('test') || '';

            if (regex) {
                document.getElementById('regexInput').value = regex;
                document.getElementById('testInput').value = test;
                
                // Set flags
                document.getElementById('flagGlobal').checked = flags.includes('g');
                document.getElementById('flagIgnoreCase').checked = flags.includes('i');
                document.getElementById('flagMultiline').checked = flags.includes('m');
                
                testRegex();
            }
        });
    </script>
</body>
</html>