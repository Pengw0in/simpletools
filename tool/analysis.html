<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/public/logo.ico">
    <title>Text Analysis</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <style>
        /* Global Reset and Retro Font */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Press Start 2P', cursive;
        }

        /* Basic Retro Color Palette */
        :root {
            --window-bg: #c0c0c0; 
            --border-dark: #808080;
            --border-light: #ffffff;
            --text-color: #000000;
            --button-face: #c0c0c0;
            --button-pressed: #dfdfdf;
            --input-bg: #ffffff;
            --header-title: #000080;
            --error-color: #ffcccc;
            --success-color: #008000;
        }

        body {
            background: var(--window-bg);
            color: var(--text-color);
            line-height: 1.6;
            padding: 30px;
        }

        /* --- Classic Windows Border Mixin --- */
        .window-frame {
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
            background: var(--window-bg);
            padding: 3px; 
            box-shadow: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0; 
        }

        /* --- Title Bar/Header --- */
        .title-bar {
            background: #008080;
            color: var(--border-light);
            padding: 5px 8px;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-dark);
        }

        .title-bar-text {
            white-space: nowrap;
        }

        /* The main window body */
        .app-body {
            padding: 15px;
        }

        /* --- Section Styling (Sunken Panel) --- */
        .section {
            margin-bottom: 15px;
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            background: var(--button-pressed);
            padding: 1px;
        }

        .section-header {
            padding: 6px 8px;
            font-size: 11px;
            font-weight: normal;
            border-top: 1px solid var(--border-dark);
            border-left: 1px solid var(--border-dark);
            border-right: 1px solid var(--border-light);
            border-bottom: 1px solid var(--border-light);
            background: #ffffff; 
            display: inline-block;
            margin-bottom: -1px;
            position: relative;
            z-index: 10;
        }

        .section-content {
            padding: 15px;
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            background: var(--window-bg);
            margin-top: -1px;
        }

        /* --- Main Grid Layout --- */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .left-column {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* --- Search Section --- */
        .search-section {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .search-input {
            flex: 1;
            padding: 6px;
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            font-size: 10px;
            background: var(--input-bg);
            color: var(--text-color);
            font-family: 'Press Start 2P', cursive;
        }
        
        .search-input:focus {
            box-shadow: 0 0 0 1px var(--text-color) inset;
            outline: none;
        }

        .search-status {
            font-size: 9px;
            color: var(--text-color);
            padding: 6px;
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            background: var(--input-bg);
            min-width: 80px;
            text-align: center;
        }

        /* --- File Upload Wrapper --- */
        .file-upload-wrapper {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }

        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-label {
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
            background: var(--button-face);
            color: var(--text-color);
            padding: 6px 12px;
            font-size: 10px;
            text-align: center;
            cursor: pointer;
            transition: none;
            box-shadow: none;
            line-height: 1;
            display: inline-block;
        }

        .file-input-label:active {
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            padding: 7px 11px 5px 13px;
        }

        .btn {
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
            background: var(--button-face);
            color: var(--text-color);
            padding: 6px 12px;
            font-size: 10px;
            text-align: center;
            cursor: pointer;
            transition: none;
            box-shadow: none;
            line-height: 1;
        }

        .btn:active {
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            padding: 7px 11px 5px 13px;
        }

        /* --- Text Highlight Container --- */
        .textarea-container {
            position: relative;
            flex: 1;
            min-height: 400px;
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            background: var(--input-bg);
        }

        .highlight-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 8px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow: auto;
            color: transparent;
            pointer-events: none;
            z-index: 1;
        }

        #textInput {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 8px;
            border: none;
            outline: none;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            resize: none;
            line-height: 1.5;
            background: transparent;
            color: var(--text-color);
            z-index: 2;
        }
        
        .highlight-match {
            background-color: #ffff00;
            color: var(--text-color);
        }

        /* --- Stats Section --- */
        .stats-header {
            padding: 8px;
            background: var(--button-pressed);
            border-bottom: 2px solid var(--border-dark);
            font-weight: normal;
            color: var(--text-color);
            font-size: 11px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            background: var(--input-bg);
        }

        .stat-item {
            padding: 12px;
            text-align: center;
            border-right: 1px solid var(--border-dark);
            border-bottom: 1px solid var(--border-dark);
        }

        .stat-item:nth-child(3n) { 
            border-right: none; 
        }
        
        .stat-item:nth-last-child(-n + 3) { 
            border-bottom: none; 
        }

        .stat-value {
            font-size: 14px;
            font-weight: normal;
            color: var(--header-title);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 9px;
            color: var(--text-color);
        }

        /* --- Detailed Stats --- */
        .detailed-stats {
            margin-bottom: 15px;
        }

        .detailed-header {
            padding: 8px;
            background: var(--button-pressed);
            border-bottom: 2px solid var(--border-dark);
            font-weight: normal;
            color: var(--text-color);
            font-size: 11px;
        }
        
        /* --- Tab Styles --- */
        .tab-bar {
            display: flex;
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            background: var(--window-bg);
            padding: 2px;
            gap: 2px;
        }

        .tab-button {
            flex: 1;
            padding: 6px 8px;
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
            background: var(--button-face);
            color: var(--text-color);
            font-size: 10px;
            cursor: pointer;
            transition: none;
            text-align: center;
        }

        .tab-button:active {
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            padding: 7px 7px 5px 9px;
        }

        .tab-button.active {
            background: var(--button-pressed);
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            padding: 7px 7px 5px 9px;
            font-weight: bold;
        }

        .detailed-content {
            padding: 12px;
            border-style: solid;
            border-width: 3px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            background: var(--input-bg);
            min-height: 200px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-dark);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-size: 10px;
            color: var(--text-color);
        }

        .detail-value {
            font-size: 10px;
            color: var(--header-title);
            font-weight: normal;
        }

        .reading-title {
            font-size: 11px;
            margin-bottom: 12px;
            color: var(--text-color);
            font-weight: normal;
        }

        .reading-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .reading-item {
            padding: 10px;
            border-style: solid;
            border-width: 2px;
            border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
            background: var(--window-bg);
            text-align: center;
        }

        .reading-item .stat-value {
            font-size: 12px;
            color: var(--header-title);
            margin-bottom: 4px;
        }

        .reading-item .stat-label {
            font-size: 8px;
            color: var(--text-color);
        }

        .empty-state {
            text-align: center;
            color: var(--border-dark);
            font-size: 10px;
            padding: 30px 15px;
        }

        .hidden {
            display: none;
        }

        /* --- Responsive Design --- */
        @media (max-width: 1000px) {
            .main-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .stat-item:nth-child(3n) { 
                border-right: 1px solid var(--border-dark); 
            }
            
            .stat-item:nth-last-child(-n + 3) { 
                border-bottom: 1px solid var(--border-dark); 
            }
            
            .stat-item:last-child { 
                border-bottom: none; 
            }
            
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                max-width: 100%;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stat-item:nth-child(2n) { 
                border-right: none; 
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-item {
                border-right: none;
            }
            
            .reading-grid {
                grid-template-columns: 1fr;
            }
            
            .file-upload-wrapper {
                flex-direction: column;
            }
            
            .file-input-label,
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container window-frame">
        <div class="title-bar">
            <div class="title-bar-text">Text Analysis</div>
        </div>
        
        <div class="app-body">
            <div class="main-grid">
                <div class="left-column">
                    <div class="section">
                        <div class="section-header">Text Input</div>
                        <div class="section-content">
                            <div class="search-section">
                                <input 
                                    type="text" 
                                    id="search-input" 
                                    class="search-input" 
                                    placeholder="Search text..." 
                                    oninput="updateStats()"
                                />
                                <span id="search-status" class="search-status">0 matches</span>
                            </div>
                            
                            <div class="file-upload-wrapper">
                                <div class="file-input-wrapper">
                                    <input type="file" id="textFile" class="file-input" accept=".txt,.md,.csv,.json,.xml,.html,.css,.js,.py,.java,.cpp,.c,.h" onchange="loadFile(event)">
                                    <label for="textFile" class="file-input-label">Upload File</label>
                                </div>
                                <button class="btn" onclick="clearText()">Clear</button>
                                <button class="btn" onclick="pasteFromClipboard()">Paste</button>
                            </div>
                            
                            <div class="textarea-container">
                                <pre id="highlight-area" class="highlight-area"></pre>
                                <textarea 
                                    id="textInput" 
                                    placeholder="Start typing or paste your text here..." 
                                    oninput="updateStats()"
                                ></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="right-column">
                    <div class="section">
                        <div class="section-header">Quick Statistics</div>
                        <div class="section-content" style="padding: 0;">
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value" id="charCount">0</div>
                                    <div class="stat-label">Characters</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="charNoSpaceCount">0</div>
                                    <div class="stat-label">No Spaces</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="wordCount">0</div>
                                    <div class="stat-label">Words</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="lineCount">0</div>
                                    <div class="stat-label">Lines</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="sentenceCount">0</div>
                                    <div class="stat-label">Sentences</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="paragraphCount">0</div>
                                    <div class="stat-label">Paragraphs</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">Detailed Analysis</div>
                        <div class="section-content" style="padding: 0;">
                            <div class="tab-bar">
                                <button class="tab-button active" onclick="switchTab('analysis')">Analysis</button>
                                <button class="tab-button" onclick="switchTab('reading')">Reading Time</button>
                            </div>
                            
                            <div id="detailsContentAnalysis" class="detailed-content">
                                <div class="empty-state">Enter some text to see analysis</div>
                            </div>
                            
                            <div id="detailsContentReading" class="detailed-content hidden">
                                <div class="empty-state">Enter some text to see reading time</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const textInput = document.getElementById('textInput');
        const searchInput = document.getElementById('search-input');
        const highlightArea = document.getElementById('highlight-area');

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function updateStats() {
            const text = textInput.value;
            const searchTerm = searchInput.value.toLowerCase();

            // Character count
            const charCount = text.length;
            document.getElementById('charCount').textContent = charCount.toLocaleString();

            // Character count without spaces
            const charNoSpace = text.replace(/\s/g, '').length;
            document.getElementById('charNoSpaceCount').textContent = charNoSpace.toLocaleString();

            // Word count
            const words = text.trim().split(/\s+/).filter(word => word.length > 0);
            const wordCount = text.trim() === '' ? 0 : words.length;
            document.getElementById('wordCount').textContent = wordCount.toLocaleString();

            // Line count
            const lines = text.split('\n');
            const lineCount = text === '' ? 0 : lines.length;
            document.getElementById('lineCount').textContent = lineCount.toLocaleString();

            // Sentence count
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
            const sentenceCount = sentences.length;
            document.getElementById('sentenceCount').textContent = sentenceCount.toLocaleString();

            // Paragraph count
            const paragraphs = text.split(/\n\s*\n/).filter(p => p.trim().length > 0);
            const paragraphCount = paragraphs.length;
            document.getElementById('paragraphCount').textContent = paragraphCount.toLocaleString();

            // Search highlighting - escape HTML first
            let highlightedText = escapeHtml(text);
            let matchCount = 0;
            
            if (searchTerm && searchTerm.length > 0) {
                const regex = new RegExp(escapeRegex(searchTerm), 'gi');
                const matches = text.match(regex);
                matchCount = matches ? matches.length : 0;
                
                highlightedText = highlightedText.replace(regex, match => `<span class="highlight-match">${match}</span>`);
            }
            
            highlightArea.innerHTML = highlightedText;
            document.getElementById('search-status').textContent = `${matchCount} match${matchCount !== 1 ? 'es' : ''}`;

            // Update detailed stats
            updateDetailedStats(text, words, wordCount);
        }

        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function updateDetailedStats(text, words, wordCount) {
            const detailsAnalysis = document.getElementById('detailsContentAnalysis');
            const detailsReading = document.getElementById('detailsContentReading');

            if (text.trim() === '') {
                detailsAnalysis.innerHTML = '<div class="empty-state">Enter some text to see analysis</div>';
                detailsReading.innerHTML = '<div class="empty-state">Enter some text to see reading time</div>';
                return;
            }

            // Analysis tab
            const avgWordLength = wordCount > 0 ? (text.replace(/\s/g, '').length / wordCount).toFixed(2) : 0;
            const uniqueWords = new Set(words.map(w => w.toLowerCase())).size;
            const longestWord = words.reduce((a, b) => a.length > b.length ? a : b, '');

            detailsAnalysis.innerHTML = `
                <div class="detail-row">
                    <span class="detail-label">Average Word Length</span>
                    <span class="detail-value">${avgWordLength} chars</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Unique Words</span>
                    <span class="detail-value">${uniqueWords.toLocaleString()}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Longest Word</span>
                    <span class="detail-value">${escapeHtml(longestWord)} (${longestWord.length} chars)</span>
                </div>
            `;

            // Reading time tab
            const wordsPerMinute = 200;
            const readingTimeMinutes = Math.ceil(wordCount / wordsPerMinute);
            const speakingTimeMinutes = Math.ceil(wordCount / 130); // Average speaking speed

            detailsReading.innerHTML = `
                <div class="reading-title">Estimated Times</div>
                <div class="reading-grid">
                    <div class="reading-item">
                        <div class="stat-value">${readingTimeMinutes}</div>
                        <div class="stat-label">min reading</div>
                    </div>
                    <div class="reading-item">
                        <div class="stat-value">${speakingTimeMinutes}</div>
                        <div class="stat-label">min speaking</div>
                    </div>
                </div>
            `;
        }

        function switchTab(tab) {
            const buttons = document.querySelectorAll('.tab-button');
            const analysisContent = document.getElementById('detailsContentAnalysis');
            const readingContent = document.getElementById('detailsContentReading');

            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (tab === 'analysis') {
                buttons[0].classList.add('active');
                analysisContent.classList.remove('hidden');
                readingContent.classList.add('hidden');
            } else {
                buttons[1].classList.add('active');
                analysisContent.classList.add('hidden');
                readingContent.classList.remove('hidden');
            }
        }

        function loadFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                textInput.value = e.target.result;
                updateStats();
            };
            reader.readAsText(file);
        }

        function clearText() {
            textInput.value = '';
            searchInput.value = '';
            document.getElementById('textFile').value = '';
            updateStats();
        }

        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                textInput.value = text;
                updateStats();
            } catch (err) {
                alert('Please paste manually using Ctrl+V (or Cmd+V on Mac)');
            }
        }

        // Initialize with empty stats
        updateStats();
    </script>
</body>
</html>